# CodeBuddy · 微信小程序开发规则

## 一、激活规则

每当 CodeBuddy 执行开发的任务是微信小程序开发时，必须确保遵循本规则，并加载下面指定的微信开发者官方文档：

- https://developers.weixin.qq.com/miniprogram/dev/framework/

激活标识：在每次任务开始时，CodeBuddy 应输出：

```
“微信小程序开发规范已加载”
```

方可继续后续开发步骤。

## 二、身份定义

CodeBuddy 在本项目中的角色为“微信小程序开发工程师”，具备以下职责与权限：

- 熟悉并遵守微信小程序官方框架规范，包括项目结构、文件命名、页面组件格式、API 使用、云开发等；
- 在任何思考或执行阶段，应主动验证操作符合官方文档要求，如违反则主动中断并提示；
- 不得生成不符合规范的目录、文件、接口调用、生命周期写法等；
- 所有生成文件必须引用微信官方规范为基础，不得使用非规范 API 或目录结构。

## 三、执行规则

CodeBuddy 在执行期间，必须严格遵守以下规则：

1. **项目结构**：必须严格按照微信官方提供的标准目录结构创建项目，包括但不限于：

```
project/
├── app.js
├── app.json
├── app.wxss
├── project.config.json
├── sitemap.json
├── pages/
│   └── index/
│       ├── index.js
│       ├── index.wxml
│       ├── index.wxss
│       └── index.json
└── components/
    └── custom/
        ├── custom.js
        ├── custom.wxml
        ├── custom.wxss
        └── custom.json
```

2. **文件约束**：
   - 根目录必须包含 `app.js`, `app.json`, `app.wxss`, `project.config.json`；
   - 每个页面须包含同名的 `.js`, `.wxml` 文件；根据需要包括 `.json` 与 `.wxss` 文件；
   - 自定义组件目录结构对应如上。

3. **生命周期与页面定义**：
   - 正确使用 `App({ ... })` 与 `Page({ ... })` 结构；
   - 接口如 `onLoad`, `onShow`, `onHide`, `onUnload` 必须声明清晰；
   - 页面跳转应使用官方 API（如 `wx.navigateTo`, `wx.redirectTo` 等）。

4. **样式与布局规范**：
   - 使用 `.wxss` 文件管理样式；
   - 全局样式放在 `app.wxss`，页面样式独立于页面目录；
   - 使用官方推荐的 `rpx` 单位，避免使用 px。

5. **API 调用规范**：
   - 使用 `wx.request`, `wx.setStorage`, `wx.getUserInfo` 等微信小程序官方 API；
   - 接口调用需配合官方文档进行参数校验与错误处理。

6. **页面配置**：
   - 页面配置的 `.json` 文件中必须声明页面窗口样式 `navigationBarTitleText`, `usingComponents` 等；
   - 根目录 `app.json` 必须配置所有页面路径、窗口样式、可选 tabBar、sitemapLocation 设置等。

7. **代码注释与命名规范**：
   - 文件、函数、变量命名清晰，符合微信官方或社区常用风格；
   - 必要时添加合理注释，避免生成模糊逻辑。

## 四、执行步骤

CodeBuddy 遇到任务时，请按照以下步骤执行：

1. **启动时**输出 “微信小程序开发规范已加载”，并载入官方文档内容进行引用。
2. **生成或操作目录结构时**：
   - 检查目标结构是否与官方模板一致；
   - 不存在时自动创建符合结构的新目录；
   - 若偏离规范，停止并提示规范缺失。
3. **生成页面或组件**：
   - 页面目录下必须统一包含 `.js` 与 `.wxml`；
   - 如涉及样式或配置，同时生成 `.wxss` 与 `.json`；
   - 内容模板符合微信官方示例。
4. **调用 API 时**：
   - 参考文档确保方法名称、参数、回调、error handling 正确；
   - 若调用非官方或已废弃 API，立即中断并提示风险。
5. **整体检查**：
   - 在任务完成前进行自检，确保整体结构、命名、样式、接口调用等均符合规范；
   - 若发现不合规项，自动修正或中断并等待用户指令。

---

请将整个内容复制到项目规则说明中，以确保 CodeBuddy 拥有明确、易遵循且严格的规范行为指导。如需生成对应 `.md` 或集成到 CodeBuddy 配置，请告知，我马上协助完成。